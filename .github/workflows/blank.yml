name: CI

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        sm-version: [ '1.10' ]

    name: SM version ${{ matrix.sm-version }}
    steps:
      - name: Setup SourceMod
        run: |
         sudo apt-get install -y lib32z1
         wget --input-file=http://sourcemod.net/smdrop/${{ matrix.sm-version }}/sourcemod-latest-linux
         tar -xzf $(cat sourcemod-latest-linux)

      - name: Setup Source
        uses: actions/checkout@master

      - name: Setup Include
        working-directory: addons/sourcemod/scripting
        run: |
          wget "http://www.doctormckay.com/download/scripting/include/morecolors.inc" -P include
          wget "https://raw.githubusercontent.com/asherkin/TF2Items/master/pawn/tf2items.inc" -P include
          wget "https://raw.githubusercontent.com/nosoop/tf2attributes/master/scripting/include/tf2attributes.inc" -O include/tf2attributes.inc
          wget "https://raw.githubusercontent.com/TeamPotry/tutorial_text/master/addons/sourcemod/scripting/include/tutorial_text.inc" -P include
          wget "https://raw.githubusercontent.com/TeamPotry/SourceMod-DBSimple/master/include/db_simple.inc" -P include
          wget "https://raw.githubusercontent.com/TeamPotry/plugins_in_FF2/master/addons/sourcemod/scripting/include/unixtime_sourcemod.inc" -P include
          wget "https://raw.githubusercontent.com/nosoop/SM-TFUtils/master/scripting/include/tf2utils.inc" -P include
          wget "https://raw.githubusercontent.com/nosoop/sourcemod-tf2wearables/master/addons/sourcemod/scripting/include/tf2wearables.inc" -P include
          wget "https://raw.githubusercontent.com/peace-maker/DHooks2/dynhooks/sourcemod_files/scripting/include/dhooks.inc" -P include
          
      - name: Compile
        working-directory: addons/sourcemod/scripting
        run: |
         pwd
         ls
         chmod +x spcomp
         chmod +x spcomp64
         mkdir compiled compiled/freak_fortress_2
         ./compile.sh freak_fortress_2.sp freak_fortress_2/*.sp

      - name: Upload plugin artifact
        uses: actions/upload-artifact@master
        with:
          name: Plugin
          path: addons/sourcemod/scripting/build
